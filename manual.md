# Manual - console-login-helper-messages

## Installation

To test out the latest RPMs in Fedora, run:

```
dnf install \
  console-login-helper-messages-issuegen \
  console-login-helper-messages-motdgen \
  console-login-helper-messages-profile
```

### Packaging

In Fedora, the console-login-helper-messages package is grouped via
subpackages in the following way:

| package                                | function |
| -------------------------------------- | --- |
| console-login-helper-messages          | base directory layout for this packge (required by all subpackages) |
| console-login-helper-messages-issuegen | messages shown on serial console using issue (SSH keys, IP address for SSH) |
| console-login-helper-messages-motdgen  | messages shown using the motd paths after SSH in (OS release information) |
| console-login-helper-messages-profile  | messages shown using /etc/profile.d script, shown on login to bash terminal (failed systemd units) |

The `install` target of the [Makefile](Makefile) is the source of truth
on where files should be placed, and which symlinks should be created.

### Integrating into a distribution

The following must be met to ship `console-login-helper-messages` by
default as part of a distribution. These instructions apply to Fedora
only as packages are only available in Fedora, currently.

First, list the names of the subpackages to include in the manifest
of base packages for the distribution (this may vary depending on the
build system). **Each individual subpackage being included must be
requested**, e.g. to install all of `issuegen`, `motdgen`, and
`profile`, list the folliwing:

```
- console-login-helper-messages-issuegen
- console-login-helper-messages-motdgen
- console-login-helper-messages-profile
```

Second, add a systemd preset to enable the issue/motd path units. E.g.:

```
# /usr/lib/systemd/system-preset/40-console-login-helper-messages.preset

enable console-login-helper-messages-issuegen.path
enable console-login-helper-messages-motdgen.path
```

## Common operations

### Enabling messages

The following enables the `motd` and `issue` messages to regenerate at
boot, and throughout the system runtime:

```
systemctl enable \
  console-login-helper-messages-issuegen.path \
  console-login-helper-messages-motdgen.path
```

One or the other may also be enabled at a time.

The `profile` messages are enabled by default by a symlink from
`/etc/profile.d` at install.

### Appending messages

- To have a message appended to the same `motd` file generated by `console-login-helper-messages-motdgen`, the files to append can be dropped in `/etc/console-login-helper-messages/motd.d/` or `/run/console-login-helper-messages/motd.d/`
- Similarly, `issue` messages to append to the same `issue` file generated by `console-login-helper-messages-issuegen` can be dropped in `/etc/console-login-helper-messages/issue.d/` or  or `/run/console-login-helper-messages/issue.d/`

Files dropped under the `/etc` location above are expected to be
unchanged during system runtime and are read only during boot. Files
dropped under the `/run` location above will trigger the
issuegen/motdgen `.path` unit, and the issue/motd message will be
updated.

### Disabling messages

The following disables the `motd` and `issue`  messages from regenerating:

```
systemctl disable \
  console-login-helper-messages-issuegen.path \
  console-login-helper-messages-motdgen.path
```

The `profile` messages can be disabled only by uninstalling
`console-login-helper-messages-profile`.

#### Silencing a generated message without disabling

If using `openssh` with `pam_motd` (default on Fedora) MOTD messages can
be silenced without completely disabling.

- Silence the `motd` generated by `console-login-helper-messages-motdgen.service` using a null symlink as follows:

    ```
    ln -s /dev/null /etc/motd.d/40_console-login-helper-messages.motd
    ```
- Currently, the `issue` generated by `console-login-helper-messages-issuegen.service` can be silenced only by uninstalling `console-login-helper-messages-issuegen`.

## Troubleshooting

### Recreating the symlinks

If a message is not showing, it could be because a symlink required to
show the message was deleted. To recreate the symlinks, the following
command can be used:

```
systemd-tmpfiles --create
```

### Regenerating the messages

To manually regenerate the `motd` or `issue`, the following commands
can be used respectively:

```
systemctl start console-login-helper-messages-motdgen.service
systemctl start console-login-helper-messages-issuegen.service
```

Otherwise, please [open an issue](https://github.com/coreos/console-login-helper-messages/issues/new)
describing the problem.
